from Crypto.Util.number import getPrime, inverse, bytes_to_long, long_to_bytes
from math import gcd

# Given output values
n1 = 4671048105912237474858249886196474268082813558195384986830547849543806444808778872546558810751448472181820329908113034663815518903150070633151387441425141
c1 = 2289377142741596469994310204100650769521849798136422018586832625913666477753348089942624629405383574433177117087802437012396056593865653078017418606022868

n2 = 5192569673876563447365360413551259737614078845667041598319037544907018012653447152040621339314422514428986315198839701126657259309488255978238602117019357
c2 = 5042492213159090611270290288968675588461806502731451924640382265268533316739479320202697233483625464126687586286263108541939440923445863501155872750947998

# Step 1: Calculate q
q = gcd(n1, n2)

# Step 2: Calculate p and r
p = n1 // q
r = n2 // q

# Step 3: Calculate phi(n1) and phi(n2)
phi_n1 = (p - 1) * (q - 1)
phi_n2 = (q - 1) * (r - 1)

# Step 4: Calculate d1 and d2
e = 0x10001
d1 = inverse(e, phi_n1)
d2 = inverse(e, phi_n2)

# Step 5: Decrypt c1 and c2
head = pow(c1, d1, n1)
tail = pow(c2, d2, n2)

# Step 6: Convert the decrypted values back to bytes
# (The lengths should match the original halves of the flag)
head_bytes = long_to_bytes(head)
tail_bytes = long_to_bytes(tail)

# Combine the head and tail to get the full flag
flag = head_bytes + tail_bytes

print(flag.decode())

